# Monte_Carlo 项目使用蒙特卡洛方法模拟粒子与材料的相互作用
[![Build Status](https://github.com/sjtug/SJTUThesis/actions/workflows/build.yml/badge.svg)](https://github.com/ShiGanXingBang/Monte_Carlo)
## Commit（fix errors）
### 第十四次提交:
- [x] 修正了粒子反射机制不起作用的 bug。

### 第十八次提交:
- [x] 将散点图设置为**从x和y方向分别扫描的完整的散点图**。试图将散点图变成连续的曲线失败，尝试过==基本样条插值函数==。

### 第十九次提交:
- [x] 之前的高斯分布函数的取值范围写完了自己不知道，改完参数后现在确定本次仿真的角度分布范围主要是（-30，30），在（-60，60）角度范围外基本上没有离子入射。
  
### 第二十二次提交
- [x] 增加了反射分布cos^n.
  
### 第二十五次提交
- [x] 增加了每次反射时的图像输出.
- [x] 修复了之前反射次数无法约束的bug。
- [x] 修复了之前反射面为垂直面无法反射的bug。
- [x] 加了一个实时显示的动态图像，由于用处不大给它删掉了。
- [x] 每次反射时可以输出当前反射次数。

### 第二十六次提交
- [x] **巨大突破**初步生成了**微沟槽效应**，并且可控制微沟槽效应的相貌。

### 第二十七次提交
- [x] 补充了一些总结结论的图，补完了week2的内容

### 第二十八次提交
- [x] 粒子入射位置改变
- [x] 加入了时间记录，记录每个程序运行的时间。
- [x] 加入了大步长+回退+小步长的三阶段加速,明显提速了三倍左右。


## 功能更新
### week5功能概述
- **粒子反射机制**：
  - 根据材料类型（如 Si 和 Hardmask）和入射角度计算反射概率。
  - 实现了粒子在不同材料表面上的反射。
- **粒子碰撞与反应**：
  - 处理粒子与材料的碰撞，计算反应概率。
  - 支持链式反应和化学反应。
- **刻蚀产额计算**：
  - 根据入射角度和能量计算刻蚀产额。
- **图像初始化与轮廓绘制**：
  - 初始化仿真界面并绘制粒子运动轨迹和材料轮廓。
- **随机粒子入射**：
  - 模拟粒子以不同的概率和角度入射到材料表面。
  - 
---
该项目通过逐步开发的方式实现了复杂的粒子模拟功能，最新的 `week5.py` 文件进一步完善了反射和碰撞机制。

## Study_Diary
### 2025.10.27
- [ ] github还有这个本地的推送和工作流有点混乱了，但是能用，晚上回来的时候再整理一下.本地的工作.工作分支可以通过按键的方式推送上去，但是无法通过git add .等方式提交暂存的programs.git push --set-upstream origin main从本地一个分支连接到已经由本地分支连接的远程项目时连接不上，晚上回来的时候anser一下this question.

- [x] vscode输入汉字的时候，部分汉字wufa直接输入例如这个wu，有时候重新dazi打字就好使了，查询原因，bing解決問題。
  **解决方法**：换成了手心输入法
### 2025.10.28
今天跟nn打了会电话，还是很思念她的，可惜只有每周周二才能跟她聊一小会。今天去听了一个关于TCAD仿真的讲座，发现自己的知识盲区以及尖端能力还是差很多的。即没有做到广度深度也不够，路远且艰，但是我不会去畏难，只要坚持前进，即使可能走错走得慢，终会有所成长。不走在很明显错误的路就是我现在要做的，this is what I need to do.
### 2025.10.29
半导体物理上课，学术理论上课，今天看了两篇之前看了一半的学术论文，对于化学反应的公式如何体现在coding中有了一点新的理解。详细内容见浙大和北方工业大学两个paper上面的文档，但是两篇文档一个主要讲的是三维蒙特卡罗算法的建模，包括怎么拟合三维的面，还有几个复杂的功能公式，另一个是我之前已经完成的一部分。
### 2025.10.31
1. 下午尝试了github学生会员
2. 确认了cursor调用claude进行ai辅助编程
3. 找到了一个claude镜像的国内网站，每天有2000token
4. 简单看了一下学术论文与写作的内容，下周三下午九十节课录视频
5. 分配了一下英语小组ppt的任务，同学给我发了一个模板
下午干了什么
1:30-2:30claude
2:30-3:00 英语分任务，作业
跟同学唠嗑唠了好久
3:00-3:30boss直聘信息完善
3:30-3:30研究生思想状况➕组内信息
4:00问cursor代码
4:30-5:50国科大学生认证
### 2025.11.1
粒子打在边界上后，沿“平行方向”钻进掩膜里，图像不对。
初步怀疑点：当局部反射面接近垂直时，当前用斜率表示法 y = b + kx，k → ∞，无法稳定生成法线与反射向量。**做ppt的时候分析一下**
解决方法：彻底弃用“斜率 k”作为核心方向表示
- 用单位方向向量 d = [dx, dy] 统一表达入射与反射方向，不再回算 k。
- 入射：由角度直接得到 d = [sin(theta), cos(theta)]（注意你的坐标系定义，确保向下为正/负一致）。
- 反射：R = d - 2(d·n)n，R 也是单位向量。
- 推进：基于 d 的符号与浮点步进来决定下一个像素，避免 k=∞。
**好处：**
- 方向表示连续稳定，不存在 ∞。
- 反射几何天然用向量公式，无需斜率。
- 与体素推进配合更自然（见第四点）。
反射次数限制那个加完了，ppt可以加上去。
### 2025.11.2
昨天情绪有些失控，过分想念你，我发现你对我的重要性似乎超出我的预期，希望早点能和你一直在一起。
今天完成任务情况：
- 增加了每次反射时的图像输出，图形化界面很重要，增加了这个后更加直观.
 - 修复了之前反射次数无法约束的bug，之前无法约束的原因是因为**清零放错了位置**，导致每次计数都无效。
 - 修复了之前反射面为垂直面无法反射的bug（因为垂直面的k为无穷大），具体方法是加了一个求**标准差**的函数。对x_list和y_list分别求标准差，小于设定阈值的发生平面反射或者垂直面反射，否则按照正常求k方法求。
 - 加了一个实时显示的动态图像，由于用处不大给它删掉了。
 - 每次反射时可以输出当前反射次数，这个是检查出反射次数无法约束的tool。
 - 问题：每次偏转的时候反射角偏转小可以，偏转往大的方向走就不行了，通过cursor调试来逐渐找错。已解决，出错原因是因为反射角度往大的方向走的时候会使反射路线先进行y值上的增加而x值不变，会导致在反射界面上进行二次反射。
### 2025.11.3
- 初步生成了微沟槽效应，并且可控制微沟槽效应的相貌。
### 2025.11.4
- 明天就能见nn了，开心~昨天参考徐老师的github做了一个自己的github的profile，还挺好看的。
### 2025.11.4
今天跟nn吵架了
### 2025.11.6
今天做ppt来的
### 2025.11.8
今天nn找我说话了
### 2025.11.9
半导体物理知识点
完成2000字个人报告（电子版），主题与小组汇报主题一致即可；提交时间：课程结束后——11月30日；届时需提交到国科大在线系统的作业板块（具体等助教开设作业提交通知）。
### 2025.11.10
继续学习半导体物理，把之前做错的作业重新看一下，改一改。明天开始写代码啵~
### 2025.11.11
- 粒子入射位置改变
- 加入了时间记录，记录每个程序运行的时间。
- 加入了大步长+回退+小步长的三阶段加速。
### 2025.11.12
- 发现改成大步长之后的反射出现错误，更改新加入的函数法线反射并没有什么改善
- 尝试寻找问题出在哪
- 检查的时候发现是入射角度出现了问题，但是程序的这块并没有问题，我也不知道怎么解决，只好改回原来的出事程序。
- wk，我发现加入这个加速模块后，居然在大步长入射的过程中反射了，但是明明不应该啊。
- 删除了refnext中冗余的部分
- 实际上根本没进入过精准入射这个函数里
- 反射的角度还是有问题，哭哭，一会要去吃饭了，错误发生在find_nearest_material_fast的第二步里。
### 2025.11.14
- 找到错误原因了，错误原因在于大步长的时候x是按照规律变化，但是y忘记添加随k方向的变化了。
- 不对不对，不是这块的问题，头大，ai也找不到问题在哪，反射的图像就是有问题。

## Test
` printf(Hello,world)`
 ~~删除线~~
```python
 printf(Hello,world)
```
1. 1.
2. 2.
3. 3.
H~2~0 + H~2~o = 2H~2~o
| 学号      | 姓名  | 年龄  |
| :--- | :---: | ---: |
| 112121  | 张三  | 24  |
| 122341 | James  | 25  |

---
